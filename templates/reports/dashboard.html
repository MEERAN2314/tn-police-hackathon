{% extends "base.html" %}

{% block title %}Reports Dashboard - TOR Analysis System{% endblock %}

{% block content %}
<div class="page-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="page-title">Reports Dashboard</h1>
            <p class="page-subtitle">Generate and manage forensic analysis reports</p>
        </div>
        <div class="flex space-x-4">
            <button id="generate-report" class="btn btn-primary">
                <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
                Generate New Report
            </button>
        </div>
    </div>
</div>

<!-- Report Types -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="card hover:shadow-lg transition-shadow cursor-pointer report-type" data-type="correlation">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-blue-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Correlation Report</h3>
            <p class="text-gray-600">Detailed analysis of traffic correlations</p>
        </div>
    </div>

    <div class="card hover:shadow-lg transition-shadow cursor-pointer report-type" data-type="threat">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-red-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.1 16,12.7V16.2C16,16.8 15.4,17.3 14.8,17.3H9.2C8.6,17.3 8,16.8 8,16.2V12.8C8,12.2 8.6,11.7 9.2,11.7V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11.5H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z"/>
                </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Threat Assessment</h3>
            <p class="text-gray-600">Security threat analysis and recommendations</p>
        </div>
    </div>

    <div class="card hover:shadow-lg transition-shadow cursor-pointer report-type" data-type="network">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-green-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
                </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Network Analysis</h3>
            <p class="text-gray-600">Comprehensive network topology report</p>
        </div>
    </div>
</div>

<!-- Recent Reports -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Recent Reports</h3>
    </div>
    <div class="card-body">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Report ID</th>
                        <th>Type</th>
                        <th>Generated</th>
                        <th>Status</th>
                        <th>Size</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>RPT-001</td>
                        <td><span class="badge badge-primary">Correlation</span></td>
                        <td>2024-01-15 14:30</td>
                        <td><span class="badge badge-success">Complete</span></td>
                        <td>2.4 MB</td>
                        <td>
                            <button class="btn btn-sm btn-secondary mr-2">Download</button>
                            <button class="btn btn-sm btn-secondary">View</button>
                        </td>
                    </tr>
                    <tr>
                        <td>RPT-002</td>
                        <td><span class="badge badge-error">Threat</span></td>
                        <td>2024-01-15 13:15</td>
                        <td><span class="badge badge-success">Complete</span></td>
                        <td>1.8 MB</td>
                        <td>
                            <button class="btn btn-sm btn-secondary mr-2">Download</button>
                            <button class="btn btn-sm btn-secondary">View</button>
                        </td>
                    </tr>
                    <tr>
                        <td>RPT-003</td>
                        <td><span class="badge badge-success">Network</span></td>
                        <td>2024-01-15 12:00</td>
                        <td><span class="badge badge-warning">Processing</span></td>
                        <td>-</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" disabled>Processing...</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Report Generation Modal -->
<div id="report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg max-w-md w-full mx-4">
        <div class="p-6">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-semibold">Generate Report</h3>
                <button id="close-report-modal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                    </svg>
                </button>
            </div>
            
            <form id="report-form" class="space-y-4">
                <div>
                    <label class="form-label">Report Type</label>
                    <select id="report-type" class="form-select">
                        <option value="correlation">Correlation Analysis</option>
                        <option value="threat">Threat Assessment</option>
                        <option value="network">Network Analysis</option>
                    </select>
                </div>
                
                <div>
                    <label class="form-label">Time Range</label>
                    <select class="form-select">
                        <option value="1h">Last Hour</option>
                        <option value="24h">Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                </div>
                
                <div>
                    <label class="form-label">Format</label>
                    <select class="form-select">
                        <option value="pdf">PDF Report</option>
                        <option value="json">JSON Data</option>
                        <option value="csv">CSV Export</option>
                    </select>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="btn btn-primary flex-1">Generate Report</button>
                    <button type="button" id="cancel-report" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Report generation functionality
document.getElementById('generate-report').addEventListener('click', () => {
    document.getElementById('report-modal').classList.remove('hidden');
});

document.getElementById('close-report-modal').addEventListener('click', () => {
    document.getElementById('report-modal').classList.add('hidden');
});

document.getElementById('cancel-report').addEventListener('click', () => {
    document.getElementById('report-modal').classList.add('hidden');
});

// Report type selection
document.querySelectorAll('.report-type').forEach(card => {
    card.addEventListener('click', (e) => {
        const type = e.currentTarget.dataset.type;
        document.getElementById('report-type').value = type;
        document.getElementById('report-modal').classList.remove('hidden');
    });
});

// Form submission
document.getElementById('report-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Show loading state
    submitBtn.innerHTML = '<div class="spinner w-4 h-4 mr-2"></div>Generating...';
    submitBtn.disabled = true;
    
    try {
        // Simulate report generation
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // Show success
        window.torApp.showNotification('Report generated successfully', 'success');
        
        // Close modal
        document.getElementById('report-modal').classList.add('hidden');
        
        // Reset form
        e.target.reset();
        
    } catch (error) {
        window.torApp.showNotification('Failed to generate report', 'error');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
</script>
{% endblock %}